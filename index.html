<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighment Data Entry System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        h1, h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
        }
        .form-label {
            font-weight: 500;
        }
        .table-responsive {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #e9ecef;
            position: sticky;
            top: 0;
        }
        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .calculated {
            background-color: #f8f9fa;
            font-weight: 500;
        }
        .section-header {
            background-color: #2c3e50;
            color: white;
            padding: 8px 15px;
            margin-top: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .report-section {
            margin-top: 30px;
        }
        .report-table {
            margin-top: 15px;
        }
        .shift-header {
            background-color: #ffc107;
            font-weight: bold;
            text-align: center;
        }
        .customer-header {
            background-color: #d8bfd8;
            font-weight: bold;
        }
        .total-header {
            background-color: #90ee90;
            font-weight: bold;
        }
        .number-cell {
            text-align: right;
        }
        .tipper-dropdown {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .btn-container {
                flex-direction: column;
            }
            .tipper-dropdown {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dispatch Weight_Bridge_Billing</h1>
        
        <form id="weighmentForm">
            <!-- Basic Information Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <label for="accountingDate" class="form-label">Accounting Date</label>
                    <input type="date" class="form-control" id="accountingDate" required>
                </div>
                <div class="col-md-2">
                    <label for="date" class="form-label">Date</label>
                    <input type="date" class="form-control" id="date" required>
                </div>
                <div class="col-md-2">
                    <label for="shift" class="form-label">Shift</label>
                    <select class="form-select" id="shift">
                        <option value="DAY SHIFT">DAY SHIFT</option>
                        <option value="NIGHT SHIFT">NIGHT SHIFT</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="weighmentSlipNo" class="form-label">Weighment Slip No</label>
                    <input type="text" class="form-control" id="weighmentSlipNo">
                </div>
                <div class="col-md-3">
                    <label for="deliveryChallanNo" class="form-label">DC No</label>
                    <input type="text" class="form-control" id="deliveryChallanNo">
                </div>
            </div>

            <!-- Royalty Information Section -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="royaltyPermitNo" class="form-label">Royalty Permit No</label>
                    <input type="text" class="form-control" id="royaltyPermitNo">
                </div>
                <div class="col-md-4">
                    <label for="permitQty" class="form-label">Permit Qty (CM)</label>
                    <input type="number" class="form-control" id="permitQty" step="0.01">
                </div>
                <div class="col-md-4">
                    <label for="royaltyRate" class="form-label">Royalty Rate</label>
                    <input type="number" class="form-control" id="royaltyRate" step="0.01">
                </div>
            </div>

            <!-- Customer Information Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <label for="customerSrNo" class="form-label">Customer Sr.No.</label>
                    <input type="text" class="form-control" id="customerSrNo">
                </div>
                <div class="col-md-5">
                    <label for="customerName" class="form-label">Name of the Customer</label>
                    <input type="text" class="form-control" id="customerName">
                </div>
                <div class="col-md-4">
                    <label for="clientDetails" class="form-label">Client Details</label>
                    <input type="text" class="form-control" id="clientDetails">
                </div>
            </div>

            <!-- Payment Information -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="paymentMode" class="form-label">Payment Terms</label>
                    <select class="form-select" id="paymentMode">
                        <option value="">Select Payment Mode</option>
                        <option value="Cash">Cash</option>
                        <option value="Credit">Credit</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="advanceReceived" class="form-label">Advance Received</label>
                    <input type="number" class="form-control" id="advanceReceived" step="0.01">
                </div>
            </div>

            <!-- Vehicle Information -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="vehicleNo" class="form-label">Vehicle No</label>
                    <div class="tipper-dropdown">
                        <select class="form-select" id="vehicleDropdown">
                            <option value="">Select Vehicle</option>
                            <option value="AP39UJ1166">AP39UJ1166</option>
                            <option value="AP39UJ2399">AP39UJ2399</option>
                            <option value="AP39UZ3659">AP39UZ3659</option>
                            <option value="AP39VF1899">AP39VF1899</option>
                            <option value="AP39UJ5678">AP39UJ5678</option>
                            <option value="AP39VF2339">AP39VF2339</option>
                            <option value="AP39W3579">AP39W3579</option>
                            <option value="AP39WC2389">AP39WC2389</option>
                            <option value="AP39TV2537">AP39TV2537</option>
                            <option value="AP39VE2979">AP39VE2979</option>
                            <option value="AP39WD5679">AP39WD5679</option>
                            <option value="AP31TN2579">AP31TN2579</option>
                            <option value="AP39UJ2489">AP39UJ2489</option>
                            <option value="AP39TV2536">AP39TV2536</option>
                            <option value="AP39WD8349">AP39WD8349</option>
                            <option value="AP39UY3345">AP39UY3345</option>
                            <option value="AP39UY3435">AP39UY3435</option>
                            <option value="AP39VC5289">AP39VC5289</option>
                            <option value="AP39WD4199">AP39WD4199</option>
                            <option value="AP39WC7449">AP39WC7449</option>
                            <option value="AP39UZ3335">AP39UZ3335</option>
                            <option value="AP39UH2489">AP39UH2489</option>
                            <option value="AP31TN4302">AP31TN4302</option>
                            <option value="AP39VB8829">AP39VB8829</option>
                            <option value="AP39UU5665">AP39UU5665</option>
                            <option value="AP39VB2427">AP39VB2427</option>
                            <option value="AP39UD1589">AP39UD1589</option>
                            <option value="AP39UF3245">AP39UF3245</option>
                            <option value="AP39UG0559">AP39UG0559</option>
                        </select>
                        <button type="button" class="btn btn-sm btn-primary" id="btnAddVehicle">Add New</button>
                    </div>
                    <input type="text" class="form-control mt-2" id="vehicleNo" placeholder="Or enter vehicle number">
                </div>
                <div class="col-md-4">
                    <label for="driverName" class="form-label">Driver Name</label>
                    <input type="text" class="form-control" id="driverName">
                </div>
                <div class="col-md-4">
                    <label for="transportRate" class="form-label">Transport Rate</label>
                    <input type="number" class="form-control" id="transportRate" step="0.01">
                </div>
            </div>

            <!-- Material Information -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="materialType" class="form-label">Material</label>
                    <select class="form-select" id="materialType">
                        <option value="">Select Material</option>
                        <option value="10 MM">10 MM</option>
                        <option value="20 MM">20 MM</option>
                        <option value="V/SAND">V/SAND</option>
                        <option value="Scalping">Scalping</option>
                        <option value="P/Sand">P/Sand</option>
                        <option value="40MM">40MM</option>
                        <option value="GSB/WET MIX">GSB/WET MIX</option>
                        <option value="R/Sand">R/Sand</option>
                    </select>
                </div>
            </div>

            <!-- Weighment Details Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <label for="grossWt" class="form-label">Gross WT</label>
                    <input type="number" class="form-control" id="grossWt" step="0.01">
                </div>
                <div class="col-md-3">
                    <label for="tareWt" class="form-label">Tare WT</label>
                    <input type="number" class="form-control" id="tareWt" step="0.01">
                </div>
                <div class="col-md-3">
                    <label for="netWt" class="form-label">NET WT (Calculated)</label>
                    <input type="number" class="form-control calculated" id="netWt" readonly>
                </div>
                <div class="col-md-3">
                    <label for="ratePerTone" class="form-label">Rate Per Tone</label>
                    <input type="number" class="form-control" id="ratePerTone" step="0.01">
                </div>
            </div>

            <!-- Financial Information Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <label for="saleAmount" class="form-label">Amount (Calculated)</label>
                    <input type="number" class="form-control calculated" id="saleAmount" readonly>
                </div>
                <div class="col-md-3">
                    <label for="cashReceived" class="form-label">Cash Received</label>
                    <input type="number" class="form-control" id="cashReceived" step="0.01">
                </div>
                <div class="col-md-3">
                    <label for="customerBalance" class="form-label">Customer Balance Amount (â‚¹)</label>
                    <input type="number" class="form-control calculated" id="customerBalance" readonly>
                </div>
                <div class="col-md-3">
                    <label for="royaltyAmount" class="form-label">Royalty Amount (Calculated)</label>
                    <input type="number" class="form-control calculated" id="royaltyAmount" readonly>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="transportAmount" class="form-label">Transport Amount (Calculated)</label>
                    <input type="number" class="form-control calculated" id="transportAmount" readonly>
                </div>
                <div class="col-md-4">
                    <label for="totalAmount" class="form-label">Total Amount (Calculated)</label>
                    <input type="number" class="form-control calculated" id="totalAmount" readonly>
                </div>
                <div class="col-md-4">
                    <label for="remarks" class="form-label">Remarks</label>
                    <input type="text" class="form-control" id="remarks">
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="btn-container">
                <button type="submit" class="btn btn-success">Save Entry</button>
                <button type="reset" class="btn btn-secondary">Clear Form</button>
                <button type="button" class="btn btn-info" id="btnCalculate">Calculate</button>
                <button type="button" class="btn btn-warning" id="btnGenerateReports">Reports</button>
            </div>
        </form>
    </div>

    <div class="container">
        <h2>Data Records</h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>S.NO</th>
                        <th>Accounting Date</th>
                        <th>Date</th>
                        <th>Weighment Slip No</th>
                        <th>DC No</th>
                        <th>Royalty Permit No</th>
                        <th>Permit Qty (CM)</th>
                        <th>Customer Sr No</th>
                        <th>Customer Name</th>
                        <th>Client Details</th>
                        <th>Payment Terms</th>
                        <th>Vehicle No</th>
                        <th>Material</th>
                        <th>Gross WT</th>
                        <th>Tare WT</th>
                        <th>NET WT</th>
                        <th>Rate Per Tone</th>
                        <th>Amount</th>
                        <th>Cash Received</th>
                        <th>Advance Received</th>
                        <th>Customer Balance</th>
                        <th>Remarks</th>
                        <th>Royalty Rate</th>
                        <th>Royalty Amount</th>
                        <th>Transport Rate</th>
                        <th>Transport Amount</th>
                        <th>Total Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recordsTable">
                    <tr>
                        <td colspan="28" class="text-center">No records found</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Reports Section -->
    <div class="container report-section">
        <h2>Reports</h2>
        
        <!-- Dispatch Vehicle Wise Planning Report -->
        <div class="section-header">Dispatch Vehicle Wise Planning Report</div>
        <div class="row mb-4">
            <div class="col-md-4">
                <label for="dispatchReportDate" class="form-label">Select Date for Report</label>
                <input type="date" class="form-control" id="dispatchReportDate">
            </div>
            <div class="col-md-3">
                <label for="dispatchReportShift" class="form-label">Select Shift</label>
                <select class="form-select" id="dispatchReportShift">
                    <option value="DAY SHIFT">DAY SHIFT</option>
                    <option value="NIGHT SHIFT">NIGHT SHIFT</option>
                    <option value="ALL">FULL DAY</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="button" class="btn btn-primary form-control" id="btnDispatchReport">Generate Dispatch Report</button>
            </div>
        </div>
        <div class="table-responsive">
            <div id="dispatchReportContainer"></div>
        </div>

        <!-- Transport Bill Report -->
        <div class="section-header">Transport Bill Report</div>
        <div class="row mb-4">
            <div class="col-md-4">
                <label for="transportBillDate" class="form-label">Select Date for Report</label>
                <input type="date" class="form-control" id="transportBillDate">
            </div>
            <div class="col-md-3">
                <label for="transportBillVehicle" class="form-label">Vehicle No (Optional)</label>
                <input type="text" class="form-control" id="transportBillVehicle" placeholder="Leave blank for all vehicles">
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="button" class="btn btn-primary form-control" id="btnTransportBill">Generate Transport Bill</button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered report-table" id="transportBillTable">
                <thead>
                    <tr>
                        <th>Vehicle No</th>
                        <th>Driver Name</th>
                        <th>Date</th>
                        <th>Shift</th>
                        <th>Material</th>
                        <th>NET WT (MT)</th>
                        <th>Trips</th>
                        <th>Transport Rate</th>
                        <th>Transport Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="9" class="text-center">No report generated yet</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Vehicle Modal -->
    <div class="modal fade" id="addVehicleModal" tabindex="-1" aria-labelledby="addVehicleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addVehicleModalLabel">Add New Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="newVehicleNo" class="form-label">Vehicle Number</label>
                        <input type="text" class="form-control" id="newVehicleNo">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnSaveVehicle">Save Vehicle</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Store all records in an array for reporting
        let allRecords = [];
        let recordIdCounter = 1;
        let vehicleNumbers = [
            "AP39UJ1166", "AP39UJ2399", "AP39UZ3659", "AP39VF1899", "AP39UJ5678", 
            "AP39VF2339", "AP39W3579", "AP39WC2389", "AP39TV2537", "AP39VE2979", 
            "AP39WD5679", "AP31TN2579", "AP39UJ2489", "AP39TV2536", "AP39WD8349", 
            "AP39UY3345", "AP39UY3435", "AP39VC5289", "AP39WD4199", "AP39WC7449", 
            "AP39UZ3335", "AP39UH2489", "AP31TN4302", "AP39VB8829", "AP39UU5665", 
            "AP39VB2427", "AP39UD1589", "AP39UF3245", "AP39UG0559"
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize vehicle dropdown
            const vehicleDropdown = document.getElementById('vehicleDropdown');
            vehicleNumbers.forEach(vehicle => {
                const option = document.createElement('option');
                option.value = vehicle;
                option.textContent = vehicle;
                vehicleDropdown.appendChild(option);
            });
            
            // Set default dates to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('accountingDate').value = today;
            document.getElementById('date').value = today;
            document.getElementById('dispatchReportDate').value = today;
            document.getElementById('transportBillDate').value = today;
            
            // Event listeners for calculations
            document.getElementById('grossWt').addEventListener('input', calculateValues);
            document.getElementById('tareWt').addEventListener('input', calculateValues);
            document.getElementById('ratePerTone').addEventListener('input', calculateValues);
            document.getElementById('royaltyRate').addEventListener('input', calculateValues);
            document.getElementById('transportRate').addEventListener('input', calculateValues);
            document.getElementById('cashReceived').addEventListener('input', calculateValues);
            document.getElementById('advanceReceived').addEventListener('input', calculateValues);
            
            // Vehicle dropdown change event
            document.getElementById('vehicleDropdown').addEventListener('change', function() {
                if (this.value) {
                    document.getElementById('vehicleNo').value = this.value;
                }
            });
            
            // Add new vehicle button
            document.getElementById('btnAddVehicle').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('addVehicleModal'));
                modal.show();
            });
            
            // Save new vehicle
            document.getElementById('btnSaveVehicle').addEventListener('click', function() {
                const newVehicleNo = document.getElementById('newVehicleNo').value.trim().toUpperCase();
                if (newVehicleNo && !vehicleNumbers.includes(newVehicleNo)) {
                    vehicleNumbers.push(newVehicleNo);
                    
                    // Add to dropdown
                    const option = document.createElement('option');
                    option.value = newVehicleNo;
                    option.textContent = newVehicleNo;
                    document.getElementById('vehicleDropdown').appendChild(option);
                    
                    // Set as selected
                    document.getElementById('vehicleDropdown').value = newVehicleNo;
                    document.getElementById('vehicleNo').value = newVehicleNo;
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addVehicleModal'));
                    modal.hide();
                    
                    // Clear input
                    document.getElementById('newVehicleNo').value = '';
                } else if (vehicleNumbers.includes(newVehicleNo)) {
                    alert("This vehicle number already exists in the list.");
                } else {
                    alert("Please enter a valid vehicle number.");
                }
            });
            
            // Manual calculation button
            document.getElementById('btnCalculate').addEventListener('click', calculateAllValues);
            
            // Report generation buttons
            document.getElementById('btnDispatchReport').addEventListener('click', generateDispatchReport);
            document.getElementById('btnTransportBill').addEventListener('click', generateTransportBill);
            
            // Form submission
            document.getElementById('weighmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addRecord();
            });
            
            function calculateValues() {
                // Calculate Net Weight
                const grossWt = parseFloat(document.getElementById('grossWt').value) || 0;
                const tareWt = parseFloat(document.getElementById('tareWt').value) || 0;
                const netWt = grossWt - tareWt;
                document.getElementById('netWt').value = netWt.toFixed(2);
                
                // Calculate Sale Amount
                const ratePerTone = parseFloat(document.getElementById('ratePerTone').value) || 0;
                const saleAmount = netWt * ratePerTone;
                document.getElementById('saleAmount').value = saleAmount.toFixed(2);
                
                // Calculate Royalty Amount
                const royaltyRate = parseFloat(document.getElementById('royaltyRate').value) || 0;
                const royaltyAmount = netWt * royaltyRate;
                document.getElementById('royaltyAmount').value = royaltyAmount.toFixed(2);
                
                // Calculate Transport Amount
                const transportRate = parseFloat(document.getElementById('transportRate').value) || 0;
                const transportAmount = netWt * transportRate;
                document.getElementById('transportAmount').value = transportAmount.toFixed(2);
                
                // Calculate Total Amount
                const totalAmount = saleAmount + royaltyAmount + transportAmount;
                document.getElementById('totalAmount').value = totalAmount.toFixed(2);
                
                // Calculate Customer Balance
                const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
                const advanceReceived = parseFloat(document.getElementById('advanceReceived').value) || 0;
                const customerBalance = totalAmount - cashReceived - advanceReceived;
                document.getElementById('customerBalance').value = customerBalance.toFixed(2);
            }
            
            function calculateAllValues() {
                calculateValues();
                alert("All values have been calculated.");
            }
            
            function addRecord() {
                calculateValues();
                
                // Get form values
                const record = {
                    id: recordIdCounter++,
                    accountingDate: document.getElementById('accountingDate').value,
                    date: document.getElementById('date').value,
                    shift: document.getElementById('shift').value,
                    weighmentSlipNo: document.getElementById('weighmentSlipNo').value,
                    deliveryChallanNo: document.getElementById('deliveryChallanNo').value,
                    royaltyPermitNo: document.getElementById('royaltyPermitNo').value,
                    permitQty: parseFloat(document.getElementById('permitQty').value) || 0,
                    royaltyRate: parseFloat(document.getElementById('royaltyRate').value) || 0,
                    customerSrNo: document.getElementById('customerSrNo').value,
                    customerName: document.getElementById('customerName').value,
                    clientDetails: document.getElementById('clientDetails').value,
                    paymentMode: document.getElementById('paymentMode').value,
                    vehicleNo: document.getElementById('vehicleNo').value,
                    driverName: document.getElementById('driverName').value,
                    materialType: document.getElementById('materialType').value,
                    transportRate: parseFloat(document.getElementById('transportRate').value) || 0,
                    grossWt: parseFloat(document.getElementById('grossWt').value) || 0,
                    tareWt: parseFloat(document.getElementById('tareWt').value) || 0,
                    netWt: parseFloat(document.getElementById('netWt').value) || 0,
                    ratePerTone: parseFloat(document.getElementById('ratePerTone').value) || 0,
                    saleAmount: parseFloat(document.getElementById('saleAmount').value) || 0,
                    cashReceived: parseFloat(document.getElementById('cashReceived').value) || 0,
                    advanceReceived: parseFloat(document.getElementById('advanceReceived').value) || 0,
                    customerBalance: parseFloat(document.getElementById('customerBalance').value) || 0,
                    royaltyAmount: parseFloat(document.getElementById('royaltyAmount').value) || 0,
                    transportAmount: parseFloat(document.getElementById('transportAmount').value) || 0,
                    totalAmount: parseFloat(document.getElementById('totalAmount').value) || 0,
                    remarks: document.getElementById('remarks').value
                };
                
                // Add to records array
                allRecords.push(record);
                
                // Update the records table
                updateRecordsTable();
                
                // Reset the form
                document.getElementById('weighmentForm').reset();
                
                // Set default dates to today again
                document.getElementById('accountingDate').value = today;
                document.getElementById('date').value = today;
                
                alert("Record added successfully!");
            }
            
            function updateRecordsTable() {
                // Get the table body
                const tableBody = document.getElementById('recordsTable');
                
                // Clear the table
                tableBody.innerHTML = '';
                
                if (allRecords.length === 0) {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.textContent = 'No records found';
                    cell.colSpan = 28;
                    cell.className = 'text-center';
                    return;
                }
                
                // Add each record to the table
                allRecords.forEach((record, index) => {
                    const row = tableBody.insertRow();
                    
                    // Add cells with data
                    row.insertCell(0).textContent = index + 1;
                    row.insertCell(1).textContent = record.accountingDate;
                    row.insertCell(2).textContent = record.date;
                    row.insertCell(3).textContent = record.weighmentSlipNo;
                    row.insertCell(4).textContent = record.deliveryChallanNo;
                    row.insertCell(5).textContent = record.royaltyPermitNo;
                    row.insertCell(6).textContent = record.permitQty.toFixed(2);
                    row.insertCell(7).textContent = record.customerSrNo;
                    row.insertCell(8).textContent = record.customerName;
                    row.insertCell(9).textContent = record.clientDetails;
                    row.insertCell(10).textContent = record.paymentMode;
                    row.insertCell(11).textContent = record.vehicleNo;
                    row.insertCell(12).textContent = record.materialType;
                    row.insertCell(13).textContent = record.grossWt.toFixed(2);
                    row.insertCell(14).textContent = record.tareWt.toFixed(2);
                    row.insertCell(15).textContent = record.netWt.toFixed(2);
                    row.insertCell(16).textContent = record.ratePerTone.toFixed(2);
                    row.insertCell(17).textContent = record.saleAmount.toFixed(2);
                    row.insertCell(18).textContent = record.cashReceived.toFixed(2);
                    row.insertCell(19).textContent = record.advanceReceived.toFixed(2);
                    row.insertCell(20).textContent = record.customerBalance.toFixed(2);
                    row.insertCell(21).textContent = record.remarks;
                    row.insertCell(22).textContent = record.royaltyRate.toFixed(2);
                    row.insertCell(23).textContent = record.royaltyAmount.toFixed(2);
                    row.insertCell(24).textContent = record.transportRate.toFixed(2);
                    row.insertCell(25).textContent = record.transportAmount.toFixed(2);
                    row.insertCell(26).textContent = record.totalAmount.toFixed(2);
                    
                    // Add actions cell
                    const actionsCell = row.insertCell(27);
                    actionsCell.innerHTML = '<button class="btn btn-sm btn-info">View</button> <button class="btn btn-sm btn-danger">Delete</button>';
                    
                    // Add event listener to delete button
                    actionsCell.querySelector('.btn-danger').addEventListener('click', function() {
                        // Remove from records array
                        allRecords = allRecords.filter(r => r.id !== record.id);
                        
                        // Update the table
                        updateRecordsTable();
                    });
                });
            }
            
            function generateDispatchReport() {
                const reportDate = document.getElementById('dispatchReportDate').value;
                const reportShift = document.getElementById('dispatchReportShift').value;
                
                if (!reportDate) {
                    alert("Please select a date for the report.");
                    return;
                }
                
                // Filter records for the selected date and shift
                let dateRecords;
                if (reportShift === "ALL") {
                    dateRecords = allRecords.filter(record => record.date === reportDate);
                } else {
                    dateRecords = allRecords.filter(record => record.date === reportDate && record.shift === reportShift);
                }
                
                if (dateRecords.length === 0) {
                    alert("No records found for the selected criteria.");
                    return;
                }
                
                // Group records by customer and material
                const customerData = {};
                const materialTypes = ["10 MM", "20 MM", "V/SAND", "Scalping", "P/Sand", "40MM", "GSB/WET MIX", "R/Sand"];
                
                dateRecords.forEach(record => {
                    if (!customerData[record.customerName]) {
                        customerData[record.customerName] = {
                            vehicles: new Set(),
                            totalTonnage: 0,
                            totalTrips: 0,
                            materials: {}
                        };
                        
                        // Initialize all material types
                        materialTypes.forEach(material => {
                            customerData[record.customerName].materials[material] = {
                                vehicles: 0,
                                tonnage: 0,
                                trips: 0
                            };
                        });
                    }
                    
                    // Add vehicle to set (to count unique vehicles)
                    customerData[record.customerName].vehicles.add(record.vehicleNo);
                    
                    // Add to total tonnage and trips
                    customerData[record.customerName].totalTonnage += record.netWt;
                    customerData[record.customerName].totalTrips += 1;
                    
                    // Add to specific material
                    if (customerData[record.customerName].materials[record.materialType]) {
                        customerData[record.customerName].materials[record.materialType].vehicles += 1;
                        customerData[record.customerName].materials[record.materialType].tonnage += record.netWt;
                        customerData[record.customerName].materials[record.materialType].trips += 1;
                    }
                });
                
                // Create report table
                let reportHTML = '<table class="table table-bordered">';
                
                // Add title row
                const formattedDate = formatDate(reportDate);
                if (reportShift === "ALL") {
                    reportHTML += `<tr class="shift-header"><th colspan="13">FULL DAY - Dispatch Vehicle Wise Planning - ${formattedDate}</th></tr>`;
                } else {
                    reportHTML += `<tr class="shift-header"><th colspan="13">${reportShift} - Dispatch Vehicle Wise Planning - ${formattedDate}</th></tr>`;
                }
                
                // Add header row
                reportHTML += '<tr class="customer-header">';
                reportHTML += '<th>Customer Name</th>';
                reportHTML += '<th>Unit (Nos., MT)</th>';
                materialTypes.forEach(material => {
                    reportHTML += `<th>${material}</th>`;
                });
                reportHTML += '<th>TOTAL</th>';
                reportHTML += '</tr>';
                
                // Add customer rows
                let grandTotalVehicles = 0;
                let grandTotalTonnage = 0;
                let grandTotalTrips = 0;
                const materialTotals = {};
                materialTypes.forEach(material => {
                    materialTotals[material] = { vehicles: 0, tonnage: 0, trips: 0 };
                });
                
                for (const customer in customerData) {
                    // Customer name row
                    reportHTML += `<tr><td rowspan="3">${customer}</td><td>No. of Vehicles</td>`;
                    
                    // Vehicle counts by material
                    materialTypes.forEach(material => {
                        const vehicleCount = customerData[customer].materials[material].vehicles;
                        reportHTML += `<td class="number-cell">${vehicleCount || ''}</td>`;
                        materialTotals[material].vehicles += vehicleCount;
                    });
                    
                    // Total vehicles for this customer
                    const customerVehicleCount = customerData[customer].vehicles.size;
                    reportHTML += `<td class="number-cell">${customerVehicleCount}</td>`;
                    grandTotalVehicles += customerVehicleCount;
                    
                    reportHTML += '</tr>';
                    
                    // Tonnage row
                    reportHTML += `<tr><td>Total Tonnage (MT)</td>`;
                    
                    // Tonnage by material
                    materialTypes.forEach(material => {
                        const tonnage = customerData[customer].materials[material].tonnage;
                        reportHTML += `<td class="number-cell">${tonnage > 0 ? tonnage.toFixed(2) : ''}</td>`;
                        materialTotals[material].tonnage += tonnage;
                    });
                    
                    // Total tonnage for this customer
                    reportHTML += `<td class="number-cell">${customerData[customer].totalTonnage.toFixed(2)}</td>`;
                    grandTotalTonnage += customerData[customer].totalTonnage;
                    
                    reportHTML += '</tr>';
                    
                    // Trips row
                    reportHTML += `<tr><td>Total Trips</td>`;
                    
                    // Trips by material
                    materialTypes.forEach(material => {
                        const trips = customerData[customer].materials[material].trips;
                        reportHTML += `<td class="number-cell">${trips > 0 ? trips : ''}</td>`;
                        materialTotals[material].trips += trips;
                    });
                    
                    // Total trips for this customer
                    reportHTML += `<td class="number-cell">${customerData[customer].totalTrips}</td>`;
                    grandTotalTrips += customerData[customer].totalTrips;
                    
                    reportHTML += '</tr>';
                }
                
                // Add totals row
                reportHTML += '<tr class="total-header">';
                reportHTML += '<td colspan="2">TOTAL</td>';
                
                // Vehicle totals by material
                materialTypes.forEach(material => {
                    reportHTML += `<td class="number-cell">${materialTotals[material].vehicles > 0 ? materialTotals[material].vehicles : ''}</td>`;
                });
                
                // Grand total vehicles
                reportHTML += `<td class="number-cell">${grandTotalVehicles}</td>`;
                reportHTML += '</tr>';
                
                // Tonnage totals row
                reportHTML += '<tr class="total-header">';
                reportHTML += '<td colspan="2"></td>';
                
                // Tonnage totals by material
                materialTypes.forEach(material => {
                    reportHTML += `<td class="number-cell">${materialTotals[material].tonnage > 0 ? materialTotals[material].tonnage.toFixed(2) : ''}</td>`;
                });
                
                // Grand total tonnage
                reportHTML += `<td class="number-cell">${grandTotalTonnage.toFixed(2)}</td>`;
                reportHTML += '</tr>';
                
                // Trips totals row
                reportHTML += '<tr class="total-header">';
                reportHTML += '<td colspan="2"></td>';
                
                // Trips totals by material
                materialTypes.forEach(material => {
                    reportHTML += `<td class="number-cell">${materialTotals[material].trips > 0 ? materialTotals[material].trips : ''}</td>`;
                });
                
                // Grand total trips
                reportHTML += `<td class="number-cell">${grandTotalTrips}</td>`;
                reportHTML += '</tr>';
                
                reportHTML += '</table>';
                
                // Display the report
                document.getElementById('dispatchReportContainer').innerHTML = reportHTML;
            }
            
            function generateTransportBill() {
                const reportDate = document.getElementById('transportBillDate').value;
                const vehicleNo = document.getElementById('transportBillVehicle').value.trim();
                
                if (!reportDate) {
                    alert("Please select a date for the report.");
                    return;
                }
                
                // Filter records for the selected date and optional vehicle
                let dateRecords;
                if (vehicleNo) {
                    dateRecords = allRecords.filter(record => 
                        record.date === reportDate && record.vehicleNo === vehicleNo
                    );
                } else {
                    dateRecords = allRecords.filter(record => record.date === reportDate);
                }
                
                if (dateRecords.length === 0) {
                    alert("No records found for the selected criteria.");
                    return;
                }
                
                // Group records by vehicle
                const vehicleData = {};
                
                dateRecords.forEach(record => {
                    if (!vehicleData[record.vehicleNo]) {
                        vehicleData[record.vehicleNo] = {
                            driverName: record.driverName || '-',
                            trips: 0,
                            totalTonnage: 0,
                            transportRate: record.transportRate,
                            transportAmount: 0,
                            records: []
                        };
                    }
                    
                    vehicleData[record.vehicleNo].trips += 1;
                    vehicleData[record.vehicleNo].totalTonnage += record.netWt;
                    vehicleData[record.vehicleNo].transportAmount += record.transportAmount;
                    vehicleData[record.vehicleNo].records.push(record);
                });
                
                // Update the report table
                const tableBody = document.querySelector('#transportBillTable tbody');
                tableBody.innerHTML = '';
                
                let totalTransportAmount = 0;
                let totalTonnage = 0;
                let totalTrips = 0;
                
                for (const vehicle in vehicleData) {
                    const data = vehicleData[vehicle];
                    
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = vehicle;
                    row.insertCell(1).textContent = data.driverName;
                    row.insertCell(2).textContent = reportDate;
                    row.insertCell(3).textContent = 'Multiple'; // Since it could be multiple shifts
                    row.insertCell(4).textContent = 'Multiple'; // Multiple materials
                    row.insertCell(5).textContent = data.totalTonnage.toFixed(2);
                    row.insertCell(6).textContent = data.trips;
                    row.insertCell(7).textContent = data.transportRate.toFixed(2);
                    row.insertCell(8).textContent = data.transportAmount.toFixed(2);
                    
                    totalTransportAmount += data.transportAmount;
                    totalTonnage += data.totalTonnage;
                    totalTrips += data.trips;
                }
                
                // Add total row
                const totalRow = tableBody.insertRow();
                totalRow.classList.add('table-active');
                totalRow.insertCell(0).textContent = 'TOTAL';
                totalRow.insertCell(1).textContent = '';
                totalRow.insertCell(2).textContent = '';
                totalRow.insertCell(3).textContent = '';
                totalRow.insertCell(4).textContent = '';
                totalRow.insertCell(5).textContent = totalTonnage.toFixed(2);
                totalRow.insertCell(6).textContent = totalTrips;
                totalRow.insertCell(7).textContent = '';
                totalRow.insertCell(8).textContent = totalTransportAmount.toFixed(2);
            }
            
            function formatDate(dateString) {
                const date = new Date(dateString);
                const day = date.getDate();
                const month = date.toLocaleString('default', { month: 'short' }).toUpperCase();
                const year = date.getFullYear();
                return `${day}-${month}-${year}`;
            }
            
            // Initialize the records table
            updateRecordsTable();
        });
    </script>
</body>
</html>
