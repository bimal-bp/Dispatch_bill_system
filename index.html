<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>WeighBridge & Transport Billing System</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 <!-- Add SheetJS library for Excel export -->
 <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
 <!-- Add jsPDF library for PDF export -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
 <style>
 body {
 font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
 background-color: #f8f9fa;
 padding: 20px;
 }
 .container {
 background-color: white;
 border-radius: 8px;
 box-shadow: 0 0 15px rgba(0,0,0,0.1);
 padding: 25px;
 margin-bottom: 30px;
 }
 h1, h2 {
 color: #2c3e50;
 margin-bottom: 25px;
 border-bottom: 2px solid #e9ecef;
 padding-bottom: 15px;
 }
 .form-label {
 font-weight: 500;
 color: #007bff;
 }
 .table-responsive {
 overflow-x: auto;
 }
 table {
 width: 100%;
 border-collapse: collapse;
 }
 th, td {
 border: 1px solid #dee2e6;
 padding: 8px;
 text-align: left;
 }
 th {
 background-color: #e9ecef;
 position: sticky;
 top: 0;
 }
 .btn-container {
 display: flex;
 gap: 10px;
 margin-top: 20px;
 }
 .calculated {
 background-color: #f8f9fa;
 font-weight: 500;
 }
 .section-header {
 background-color: #2c3e50;
 color: white;
 padding: 8px 15px;
 margin-top: 20px;
 margin-bottom: 15px;
 border-radius: 5px;
 }
 .report-section {
 margin-top: 30px;
 }
 .report-table {
 margin-top: 15px;
 }
 .shift-header {
 background-color: #ffc107;
 font-weight: bold;
 text-align: center;
 }
 .customer-header {
 background-color: #d8bfd8;
 font-weight: bold;
 }
 .total-header {
 background-color: #90ee90;
 font-weight: bold;
 }
 .number-cell {
 text-align: right;
 }
 .tipper-dropdown {
 display: flex;
 align-items: center;
 gap: 10px;
 margin-bottom: 10px;
 }
 .transaction-details {
 background-color: #f8f9fa;
 padding: 10px;
 border-radius: 5px;
 margin-top: 5px;
 }
 .transaction-row {
 border-bottom: 1px solid #dee2e6;
 padding: 5px 0;
 }
 .transaction-row:last-child {
 border-bottom: none;
 }
 @media (max-width: 768px) {
 .btn-container {
 flex-direction: column;
 }
 .tipper-dropdown {
 flex-direction: column;
 align-items: flex-start;
 }
 }
 .report-actions {
 margin-top: 15px;
 margin-bottom: 15px;
 }
 </style>
</head>
<body>
 <div class="container">
 <h1>WeighBridge & Transport Billing System</h1>
 
 <form id="weighmentForm">
 <!-- Basic Information Section -->
 <div class="row mb-4">
 <div class="col-md-3">
 <label for="accountingDate" class="form-label">Accounting Date</label>
 <input type="date" class="form-control" id="accountingDate" required>
 </div>
 <div class="col-md-2">
 <label for="date" class="form-label">Date</label>
 <input type="date" class="form-control" id="date" required>
 </div>
 <div class="col-md-2">
 <label for="shift" class="form-label">Shift</label>
 <select class="form-select" id="shift">
 <option value="A-SHIFT">A-SHIFT</option>
 <option value="B-SHIFT">B-SHIFT</option>
 </select>
 </div>
 <div class="col-md-2">
 <label for="weighmentSlipNo" class="form-label">Weighment Slip No</label>
 <input type="text" class="form-control" id="weighmentSlipNo">
 </div>
 <div class="col-md-3">
 <label for="deliveryChallanNo" class="form-label">DC No</label>
 <input type="text" class="form-control" id="deliveryChallanNo">
 </div>
 </div>
 <!-- Royalty Information Section -->
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="royaltyPermitNo" class="form-label">Royalty Permit No</label>
 <input type="text" class="form-control" id="royaltyPermitNo">
 </div>
 <div class="col-md-4">
 <label for="permitQty" class="form-label">Permit Qty (CM)</label>
 <input type="number" class="form-control" id="permitQty" step="0.01">
 </div>
 <div class="col-md-4">
 <label for="royaltyRate" class="form-label">Royalty Rate</label>
 <input type="number" class="form-control" id="royaltyRate" step="0.01">
 </div>
 </div>
 <!-- Customer Information Section -->
 <div class="row mb-4">
 <div class="col-md-3">
 <label for="customerSrNo" class="form-label">Customer Sr.No.</label>
 <input type="text" class="form-control" id="customerSrNo">
 </div>
 <div class="col-md-5">
 <label for="customerName" class="form-label">Name of the Customer</label>
 <input type="text" class="form-control" id="customerName">
 </div>
 <div class="col-md-4">
 <label for="clientDetails" class="form-label">Client Details</label>
 <input type="text" class="form-control" id="clientDetails">
 </div>
 </div>
 <!-- Payment Information -->
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="paymentMode" class="form-label">Payment Terms</label>
 <select class="form-select" id="paymentMode">
 <option value="">Select Payment Mode</option>
 <option value="Cash">Cash</option>
 <option value="Credit">Credit</option>
 </select>
 </div>
 <div class="col-md-4">
 <label for="advanceReceived" class="form-label">Advance Received</label>
 <input type="number" class="form-control" id="advanceReceived" step="0.01">
 </div>
 </div>
 <!-- Vehicle Information -->
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="vehicleNo" class="form-label">Vehicle No</label>
 <div class="tipper-dropdown">
 <select class="form-select" id="vehicleDropdown">
 <option value="">Select Vehicle</option>
 <option value="AP39UJ1166">AP39UJ1166</option>
 <option value="AP39UJ2399">AP39UJ2399</option>
 <option value="AP39UZ3659">AP39UZ3659</option>
 <option value="AP39VF1899">AP39VF1899</option>
 <option value="AP39UJ5678">AP39UJ5678</option>
 <option value="AP39VF2339">AP39VF2339</option>
 <option value="AP39W3579">AP39W3579</option>
 <option value="AP39WC2389">AP39WC2389</option>
 <option value="AP39TV2537">AP39TV2537</option>
 <option value="AP39VE2979">AP39VE2979</option>
 <option value="AP39WD5679">AP39WD5679</option>
 <option value="AP31TN2579">AP31TN2579</option>
 <option value="AP39UJ2489">AP39UJ2489</option>
 <option value="AP39TV2536">AP39TV2536</option>
 <option value="AP39WD8349">AP39WD8349</option>
 <option value="AP39UY3345">AP39UY3345</option>
 <option value="AP39UY3435">AP39UY3435</option>
 <option value="AP39VC5289">AP39VC5289</option>
 <option value="AP39WD4199">AP39WD4199</option>
 <option value="AP39WC7449">AP39WC7449</option>
 <option value="AP39UZ3335">AP39UZ3335</option>
 <option value="AP39UH2489">AP39UH2489</option>
 <option value="AP31TN4302">AP31TN4302</option>
 <option value="AP39VB8829">AP39VB8829</option>
 <option value="AP39UU5665">AP39UU5665</option>
 <option value="AP39VB2427">AP39VB2427</option>
 <option value="AP39UD1589">AP39UD1589</option>
 <option value="AP39UF3245">AP39UF3245</option>
 <option value="AP39UG0559">AP39UG0559</option>
 </select>
 <button type="button" class="btn btn-sm btn-primary" id="btnAddVehicle">Add New</button>
 </div>
 <input type="text" class="form-control mt-2" id="vehicleNo" placeholder="Or enter vehicle number">
 </div>
 <div class="col-md-4">
 <label for="transportRate" class="form-label">Transport Rate</label>
 <input type="number" class="form-control" id="transportRate" step="0.01">
 </div>
 </div>
 <!-- Material Information -->
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="materialType" class="form-label">Material</label>
 <select class="form-select" id="materialType">
 <option value="">Select Material</option>
 <option value="10 MM">10 MM</option>
 <option value="20 MM">20 MM</option>
 <option value="V/SAND">V/SAND</option>
 <option value="Scalping">Scalping</option>
 <option value="P/Sand">P/Sand</option>
 <option value="40MM">40MM</option>
 <option value="GSB/WET MIX">GSB/WET MIX</option>
 <option value="R/Sand">R/Sand</option>
 </select>
 </div>
 </div>
 <!-- Weighment Details Section -->
 <div class="row mb-4">
 <div class="col-md-3">
 <label for="grossWt" class="form-label">Gross WT</label>
 <input type="number" class="form-control" id="grossWt" step="0.01">
 </div>
 <div class="col-md-3">
 <label for="tareWt" class="form-label">Tare WT</label>
 <input type="number" class="form-control" id="tareWt" step="0.01">
 </div>
 <div class="col-md-3">
 <label for="netWt" class="form-label">NET WT (Calculated)</label>
 <input type="number" class="form-control calculated" id="netWt" readonly>
 </div>
 <div class="col-md-3">
 <label for="ratePerTone" class="form-label">Rate Per Tone</label>
 <input type="number" class="form-control" id="ratePerTone" step="0.01">
 </div>
 </div>
 <!-- Financial Information Section -->
 <div class="row mb-4">
 <div class="col-md-3">
 <label for="saleAmount" class="form-label">Amount (Calculated)</label>
 <input type="number" class="form-control calculated" id="saleAmount" readonly>
 </div>
 <div class="col-md-3">
 <label for="cashReceived" class="form-label">Cash Received</label>
 <input type="number" class="form-control" id="cashReceived" step="0.01">
 </div>
 <div class="col-md-3">
 <label for="customerBalance" class="form-label">Customer Balance Amount (â‚¹)</label>
 <input type="number" class="form-control calculated" id="customerBalance" readonly>
 </div>
 <div class="col-md-3">
 <label for="royaltyAmount" class="form-label">Royalty Amount (Calculated)</label>
 <input type="number" class="form-control calculated" id="royaltyAmount" readonly>
 </div>
 </div>
 <!-- Additional Information -->
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="transportAmount" class="form-label">Transport Amount (Calculated)</label>
 <input type="number" class="form-control calculated" id="transportAmount" readonly>
 </div>
 <div class="col-md-4">
 <label for="totalAmount" class="form-label">Total Amount (Calculated)</label>
 <input type="number" class="form-control calculated" id="totalAmount" readonly>
 </div>
 <div class="col-md-4">
 <label for="remarks" class="form-label">Remarks</label>
 <input type="text" class="form-control" id="remarks">
 </div>
 </div>
 <!-- Action Buttons -->
 <div class="btn-container">
 <button type="submit" class="btn btn-success">Save Entry</button>
 <button type="button" class="btn btn-primary" id="btnExportExcel">Export to Excel</button>
 </div>
 </form>
 </div>
 <div class="container">
 <h2>Data Records</h2>
 <div class="table-responsive">
 <table class="table table-striped table-bordered" id="mainDataTable">
 <thead>
 <tr>
 <th>S.NO</th>
 <th>Accounting Date</th>
 <th>Date</th>
 <th>Weighment Slip No</th>
 <th>DC No</th>
 <th>Royalty Permit No</th>
 <th>Permit Qty (CM)</th>
 <th>Customer Sr No</th>
 <th>Customer Name</th>
 <th>Client Details</th>
 <th>Payment Terms</th>
 <th>Vehicle No</th>
 <th>Material</th>
 <th>Gross WT</th>
 <th>Tare WT</th>
 <th>NET WT</th>
 <th>Rate Per Tone</th>
 <th>Amount</th>
 <th>Cash Received</th>
 <th>Advance Received</th>
 <th>Customer Balance</th>
 <th>Remarks</th>
 <th>Royalty Rate</th>
 <th>Royalty Amount</th>
 <th>Transport Rate</th>
 <th>Transport Amount</th>
 <th>Total Amount</th>
 <th>Actions</th>
 </tr>
 </thead>
 <tbody id="recordsTable">
 <tr>
 <td colspan="28" class="text-center">No records found</td>
 </tr>
 </tbody>
 </table>
 </div>
 </div>
 <!-- Reports Section -->
 <div class="container report-section">
 <h2>Reports</h2>
 
 <!-- Dispatch Vehicle Wise Planning Report -->
 <div class="section-header">Dispatch Vehicle Wise Planning Report</div>
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="dispatchReportDate" class="form-label">Select Date for Report</label>
 <input type="date" class="form-control" id="dispatchReportDate">
 </div>
 <div class="col-md-3">
 <label for="dispatchReportShift" class="form-label">Select Shift</label>
 <select class="form-select" id="dispatchReportShift">
 <option value="A-SHIFT">A-SHIFT</option>
 <option value="B-SHIFT">B-SHIFT</option>
 <option value="ALL">FULL DAY</option>
 </select>
 </div>
 <div class="col-md-2">
 <label class="form-label">&nbsp;</label>
 <button type="button" class="btn btn-primary form-control" id="btnDispatchReport">Generate Dispatch Report</button>
 </div>
 </div>
 <div class="report-actions" id="dispatchReportActions" style="display: none;">
 <button type="button" class="btn btn-success" id="btnDownloadDispatchPDF">Download PDF Report</button>
 </div>
 <div class="table-responsive">
 <div id="dispatchReportContainer"></div>
 </div>
 <!-- FTD (Full Truck Dispatch) Report -->
 <div class="section-header">FTD (Full Truck Dispatch) Report</div>
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="ftdReportDate" class="form-label">Select Date for Report</label>
 <input type="date" class="form-control" id="ftdReportDate">
 </div>
 <div class="col-md-3">
 <label for="ftdReportShift" class="form-label">Select Shift</label>
 <select class="form-select" id="ftdReportShift">
 <option value="A-SHIFT">A-SHIFT</option>
 <option value="B-SHIFT">B-SHIFT</option>
 <option value="ALL">FULL DAY</option>
 </select>
 </div>
 <div class="col-md-2">
 <label class="form-label">&nbsp;</label>
 <button type="button" class="btn btn-primary form-control" id="btnFtdReport">Generate FTD Report</button>
 </div>
 </div>
 <div class="report-actions" id="ftdReportActions" style="display: none;">
 <button type="button" class="btn btn-success" id="btnDownloadFtdPDF">Download PDF Report</button>
 </div>
 <div class="table-responsive">
 <div id="ftdReportContainer"></div>
 </div>
 <!-- Transport Bill Report -->
 <div class="section-header">Transport Bill Report</div>
 <div class="row mb-4">
 <div class="col-md-4">
 <label for="transportBillDate" class="form-label">Select Date Range</label>
 <div class="input-group">
 <input type="date" class="form-control" id="transportBillStartDate">
 <span class="input-group-text">to</span>
 <input type="date" class="form-control" id="transportBillEndDate">
 </div>
 </div>
 <div class="col-md-3">
 <label for="transportBillVehicle" class="form-label">Vehicle No (Optional)</label>
 <input type="text" class="form-control" id="transportBillVehicle" placeholder="Leave blank for all vehicles">
 </div>
 <div class="col-md-2">
 <label class="form-label">&nbsp;</label>
 <button type="button" class="btn btn-primary form-control" id="btnTransportBill">Generate Transport Bill</button>
 </div>
 </div>
 <div class="report-actions" id="transportReportActions" style="display: none;">
 <button type="button" class="btn btn-success" id="btnDownloadTransportPDF">Download PDF Report</button>
 </div>
 <div class="table-responsive">
 <table class="table table-bordered report-table" id="transportBillTable">
 <thead>
 <tr>
 <th>Vehicle No</th>
 <th>Total Trips</th>
 <th>Total NET WT (MT)</th>
 <th>Total Transport Amount</th>
 <th>Transaction Details</th>
 </tr>
 </thead>
 <tbody>
 <tr>
 <td colspan="5" class="text-center">No report generated yet</td>
 </tr>
 </tbody>
 </table>
 </div>
 </div>
 <!-- Add Vehicle Modal -->
 <div class="modal fade" id="addVehicleModal" tabindex="-1" aria-labelledby="addVehicleModalLabel" aria-hidden="true">
 <div class="modal-dialog">
 <div class="modal-content">
 <div class="modal-header">
 <h5 class="modal-title" id="addVehicleModalLabel">Add New Vehicle</h5>
 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
 </div>
 <div class="modal-body">
 <div class="mb-3">
 <label for="newVehicleNo" class="form-label">Vehicle Number</label>
 <input type="text" class="form-control" id="newVehicleNo">
 </div>
 </div>
 <div class="modal-footer">
 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
 <button type="button" class="btn btn-primary" id="btnSaveVehicle">Save Vehicle</button>
 </div>
 </div>
 </div>
 </div>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <script>
 // Initialize jsPDF
 window.jsPDF = window.jspdf.jsPDF;
 // Store all records in an array for reporting
 let allRecords = [];
 let recordIdCounter = 1;
 let vehicleNumbers = [
 "AP39UJ1166", "AP39UJ2399", "AP39UZ3659", "AP39VF1899", "AP39UJ5678",
 "AP39VF2339", "AP39W3579", "AP39WC2389", "AP39TV2537", "AP39VE2979",
 "AP39WD5679", "AP31TN2579", "AP39UJ2489", "AP39TV2536", "AP39WD8349",
 "AP39UY3345", "AP39UY3435", "AP39VC5289", "AP39WD4199", "AP39WC7449",
 "AP39UZ3335", "AP39UH2489", "AP31TN4302", "AP39VB8829", "AP39UU5665",
 "AP39VB2427", "AP39UD1589", "AP39UF3245", "AP39UG0559"
 ];
 // Store report data for PDF export
 let currentDispatchReportData = null;
 let currentFtdReportData = null;
 let currentTransportReportData = null;
 document.addEventListener('DOMContentLoaded', function() {
 // Initialize vehicle dropdown
 const vehicleDropdown = document.getElementById('vehicleDropdown');
 vehicleNumbers.forEach(vehicle => {
 const option = document.createElement('option');
 option.value = vehicle;
 option.textContent = vehicle;
 vehicleDropdown.appendChild(option);
 });
 
 // Set default dates to today
 const today = new Date().toISOString().split('T')[0];
 document.getElementById('accountingDate').value = today;
 document.getElementById('date').value = today;
 document.getElementById('dispatchReportDate').value = today;
 document.getElementById('ftdReportDate').value = today;
 document.getElementById('transportBillStartDate').value = today;
 document.getElementById('transportBillEndDate').value = today;
 
 // Event listeners for calculations
 document.getElementById('grossWt').addEventListener('input', calculateValues);
 document.getElementById('tareWt').addEventListener('input', calculateValues);
 document.getElementById('ratePerTone').addEventListener('input', calculateValues);
 document.getElementById('royaltyRate').addEventListener('input', calculateValues);
 document.getElementById('transportRate').addEventListener('input', calculateValues);
 document.getElementById('cashReceived').addEventListener('input', calculateValues);
 document.getElementById('advanceReceived').addEventListener('input', calculateValues);
 
 // Vehicle dropdown change event
 document.getElementById('vehicleDropdown').addEventListener('change', function() {
 if (this.value) {
 document.getElementById('vehicleNo').value = this.value;
 }
 });
 
 // Add new vehicle button
 document.getElementById('btnAddVehicle').addEventListener('click', function() {
 const modal = new bootstrap.Modal(document.getElementById('addVehicleModal'));
 modal.show();
 });
 
 // Save new vehicle
 document.getElementById('btnSaveVehicle').addEventListener('click', function() {
 const newVehicleNo = document.getElementById('newVehicleNo').value.trim().toUpperCase();
 if (newVehicleNo && !vehicleNumbers.includes(newVehicleNo)) {
 vehicleNumbers.push(newVehicleNo);
 
 // Add to dropdown
 const option = document.createElement('option');
 option.value = newVehicleNo;
 option.textContent = newVehicleNo;
 document.getElementById('vehicleDropdown').appendChild(option);
 
 // Set as selected
 document.getElementById('vehicleDropdown').value = newVehicleNo;
 document.getElementById('vehicleNo').value = newVehicleNo;
 
 // Close modal
 const modal = bootstrap.Modal.getInstance(document.getElementById('addVehicleModal'));
 modal.hide();
 
 // Clear input
 document.getElementById('newVehicleNo').value = '';
 } else if (vehicleNumbers.includes(newVehicleNo)) {
 alert("This vehicle number already exists in the list.");
 } else {
 alert("Please enter a valid vehicle number.");
 }
 });
 
 // Report generation buttons
 document.getElementById('btnDispatchReport').addEventListener('click', generateDispatchReport);
 document.getElementById('btnFtdReport').addEventListener('click', generateFtdReport);
 document.getElementById('btnTransportBill').addEventListener('click', generateTransportBill);
 
 // PDF download buttons
 document.getElementById('btnDownloadDispatchPDF').addEventListener('click', downloadDispatchPDF);
 document.getElementById('btnDownloadFtdPDF').addEventListener('click', downloadFtdPDF);
 document.getElementById('btnDownloadTransportPDF').addEventListener('click', downloadTransportPDF);
 
 // Form submission
 document.getElementById('weighmentForm').addEventListener('submit', function(e) {
 e.preventDefault();
 addRecord();
 });
 
 // Export to Excel button
 document.getElementById('btnExportExcel').addEventListener('click', exportToExcel);
 
 function calculateValues() {
 // Calculate Net Weight
 const grossWt = parse
